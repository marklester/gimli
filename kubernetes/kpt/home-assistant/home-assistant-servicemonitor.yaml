apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: home-assistant
  namespace: monitoring
  labels:
    app: home-assistant
    release: "prometheus-operator"
spec:
  selector:
    matchLabels:
      app: home-assistant
  namespaceSelector:
    matchNames:
    - home-assistant
  endpoints:
  - targetPort: 8123 
    path: /api/prometheus
    bearerTokenSecret:
      name: hass-metrics-token
      key: token
---
apiVersion: v1
kind: Secret
metadata:
  name: hass-metrics-token
  namespace: monitoring
type: Opaque
stringData:
  token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJmMDE4NDMwMTA0YTg0ZDBmOTlkNmExNTU4OWQyODM0MiIsImlhdCI6MTU5NTQ1ODA1NiwiZXhwIjoxOTEwODE4MDU2fQ.eHdgm-wFDyoevifivcqDmVtOu29W5ARMn16RDTmnnqw